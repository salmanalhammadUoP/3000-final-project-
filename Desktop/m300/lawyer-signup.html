<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lawyer Registration | My Lawyer Portal</title>
  <style>
    /* 1. Updated Theme: Moving away from the generic 2c3e50 blue */
    :root {
      --primary: #1a2a3a;
      --accent: #d4af37; /* Professional Gold accent */
      --bg: #f8f9fa;
      --text: #333;
      --error: #dc3545;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }

    nav { background: var(--primary); padding: 1rem 5%; display: flex; justify-content: space-between; align-items: center; }
    .logo { color: white; font-size: 1.2rem; font-weight: 700; text-decoration: none; letter-spacing: 1px; }

    .signup-container { max-width: 550px; margin: 40px auto; padding: 0 20px; }
    
    .form-card { 
      background: white; 
      padding: 40px; 
      border-radius: 12px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
      border-top: 4px solid var(--accent); 
    }

    h1 { font-size: 22px; margin-bottom: 25px; color: var(--primary); text-align: center; }

    .form-group { margin-bottom: 20px; }
    label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 8px; text-transform: uppercase; color: #666; }
    
    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 15px;
      transition: all 0.2s ease;
    }

    input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1); }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

    .btn-submit {
      width: 100%;
      padding: 14px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
    }

    .btn-submit:hover { opacity: 0.9; transform: translateY(-1px); }
    .btn-submit:disabled { background: #ccc; cursor: not-allowed; transform: none; }

    .alert { padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none; font-size: 14px; text-align: center; }
    .alert-error { background: #fff5f5; color: var(--error); border: 1px solid #ffc9c9; }
    .alert-success { background: #f0fff4; color: #2f855a; border: 1px solid #c6f6d5; }

    .footer-links { text-align: center; margin-top: 25px; font-size: 14px; color: #777; }
    .footer-links a { color: var(--primary); text-decoration: none; font-weight: 600; }

    @media (max-width: 500px) { .grid-2 { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

  <nav>
    <a href="index.html" class="logo">MY LAWYER</a>
  </nav>

  <div class="signup-container">
    <div class="form-card">
      <h1>Create Professional Profile</h1>
      
      <div id="statusMessage" class="alert"></div>
      
      <form id="lawyerRegistrationForm">
        <div class="form-group">
          <label for="fullName">Full Name</label>
          <input type="text" id="fullName" required placeholder="Adv. Jane Doe">
        </div>

        <div class="form-group">
          <label for="email">Work Email</label>
          <input type="email" id="email" required placeholder="jane.doe@firm.com">
        </div>

        <div class="grid-2">
          <div class="form-group">
            <label for="pass">Password</label>
            <input type="password" id="pass" minlength="8" required>
          </div>
          <div class="form-group">
            <label for="confirmPass">Confirm</label>
            <input type="password" id="confirmPass" required>
          </div>
        </div>

        <div class="form-group">
          <label for="spec">Practice Area</label>
          <select id="spec" required>
            <option value="" disabled selected>Select Area...</option>
            <option value="Family Law">Family Law</option>
            <option value="Criminal Defense">Criminal Defense</option>
            <option value="Corporate">Corporate & Commercial</option>
            <option value="Real Estate">Real Estate</option>
            <option value="Immigration">Immigration</option>
          </select>
        </div>

        <div class="grid-2">
          <div class="form-group">
            <label for="license">Bar License #</label>
            <input type="text" id="license" required>
          </div>
          <div class="form-group">
            <label for="exp">Experience (Yrs)</label>
            <input type="number" id="exp" min="0" max="60" required>
          </div>
        </div>

        <div class="form-group">
          <label for="hourlyRate">Consultation Fee ($/hr)</label>
          <input type="number" id="hourlyRate" min="0" step="10" required>
        </div>

        <div class="form-group">
          <label for="bio">Professional Summary</label>
          <textarea id="bio" rows="4" placeholder="Brief overview of your legal background..."></textarea>
        </div>

        <button type="submit" class="btn-submit" id="submitBtn">Register Account</button>
      </form>

      <div class="footer-links">
        Already have an account? <a href="lawyer-login.html">Sign In</a>
      </div>
    </div>
  </div>

  <script type="module">
    import { auth, db } from './js/firebase.js';
    import { createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
    import { doc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    // 2. Human-style logic: Using a class or structured functions rather than one giant block
    const UI = {
      form: document.getElementById('lawyerRegistrationForm'),
      btn: document.getElementById('submitBtn'),
      alert: document.getElementById('statusMessage'),
      
      notify(msg, type) {
        this.alert.textContent = msg;
        this.alert.className = `alert alert-${type}`;
        this.alert.style.display = 'block';
      },
      
      setLoading(loading) {
        this.btn.disabled = loading;
        this.btn.textContent = loading ? 'Processing...' : 'Register Account';
      }
    };

    const handleRegistration = async (e) => {
      e.preventDefault();
      
      // Client-side validation
      const pass = document.getElementById('pass').value;
      const confirm = document.getElementById('confirmPass').value;
      
      if (pass !== confirm) {
        return UI.notify('Passwords do not match.', 'error');
      }

      UI.setLoading(true);

      try {
        const email = document.getElementById('email').value.trim().toLowerCase();
        const { user } = await createUserWithEmailAndPassword(auth, email, pass);

        // 3. Robust Data Structure
        // Using serverTimestamp() instead of client-side new Date()
        const lawyerProfile = {
          uid: user.uid,
          name: document.getElementById('fullName').value.trim(),
          email: email,
          type: 'lawyer',
          specialization: document.getElementById('spec').value,
          barLicense: document.getElementById('license').value.trim(),
          experience: parseInt(document.getElementById('exp').value),
          rate: parseInt(document.getElementById('hourlyRate').value),
          bio: document.getElementById('bio').value.trim() || 'No bio provided.',
          stats: {
            rating: 0,
            reviewCount: 0
          },
          accountStatus: 'pending_verification', // Realistic professional workflow
          joinedAt: serverTimestamp() 
        };

        await setDoc(doc(db, 'users', user.uid), lawyerProfile);

        UI.notify('Registration successful! Redirecting...', 'success');
        setTimeout(() => window.location.href = 'lawyer-dashboard.html', 1500);

      } catch (err) {
        console.error("Signup Error:", err);
        let errorMsg = "Failed to create account. Please try again.";
        
        if (err.code === 'auth/email-already-in-use') errorMsg = "Email is already registered.";
        if (err.code === 'auth/weak-password') errorMsg = "Password must be at least 8 characters.";
        
        UI.notify(errorMsg, 'error');
        UI.setLoading(false);
      }
    };

    UI.form.addEventListener('submit', handleRegistration);
  </script>
</body>
</html>